<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pitwall - F1 ì„œí‚· ê°€ì´ë“œ</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet"/>
    <link rel="stylesheet" href="style.css">
    <style>
        .circuit-container { max-width: 1200px; margin: 0 auto; padding: 40px 20px; }
        
        /* ê²€ìƒ‰ì°½ */
        .search-box { text-align: center; margin-bottom: 40px; }
        .search-input {
            padding: 12px 20px; width: 100%; max-width: 500px;
            border-radius: 30px; border: 1px solid #444;
            background: #222; color: white; font-size: 1.1rem; outline: none;
        }
        .search-input:focus { border-color: #e10600; }

        /* ê·¸ë¦¬ë“œ */
        .circuit-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 30px;
        }

        /* ì¹´ë“œ */
        .circuit-card {
            background: #1e1e1e; border-radius: 15px; overflow: hidden;
            border: 1px solid #333; transition: transform 0.3s, box-shadow 0.3s;
            cursor: pointer; /* í´ë¦­ ê°€ëŠ¥ í‘œì‹œ */
        }
        .circuit-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.5);
            border-color: #e10600;
        }

        .circuit-img-box { padding: 20px; background: #fff; text-align: center; }
        .circuit-img { width: 100%; height: auto; object-fit: contain; }
        .circuit-info { padding: 25px; }
        .circuit-name { font-size: 1.5rem; margin-bottom: 5px; color: #fff; }
        .circuit-location { color: #888; font-size: 0.9rem; margin-bottom: 15px; }
        
        .stats-grid {
            display: grid; grid-template-columns: 1fr 1fr; gap: 15px;
            margin-top: 20px; padding-top: 20px; border-top: 1px solid #333;
        }
        .stat-item span { display: block; color: #666; font-size: 0.8rem; }
        .stat-item strong { color: #fff; font-size: 1.1rem; }

        /* --- ëª¨ë‹¬(íŒì—…) ìŠ¤íƒ€ì¼ --- */
        .modal-overlay {
            display: none; /* í‰ì†Œì—” ìˆ¨ê¹€ */
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.8); z-index: 1000;
            align-items: center; justify-content: center;
        }
        .modal-content {
            background: #1e1e1e; width: 90%; max-width: 600px;
            border-radius: 15px; padding: 30px; border: 1px solid #e10600;
            position: relative; animation: popIn 0.3s ease;
        }
        @keyframes popIn { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        
        .close-btn {
            position: absolute; top: 15px; right: 20px; font-size: 2rem; color: #aaa;
            cursor: pointer; background: none; border: none;
        }
        .close-btn:hover { color: #fff; }

        .record-list { list-style: none; padding: 0; margin-top: 20px; }
        .record-item {
            background: #2a2a2a; padding: 15px; border-radius: 8px;
            margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center;
        }
        .record-type { color: #e10600; font-weight: bold; font-size: 0.9rem; display: block; margin-bottom: 5px; }
        .record-val { color: #fff; font-size: 1.1rem; font-weight: bold; }
        .record-driver { color: #aaa; font-size: 0.9rem; text-align: right; }
    </style>
</head>
<body>
    <div id="header-placeholder"></div>
    <script src="header.js"></script>

    <main class="circuit-container">
        <section style="text-align: center; margin-bottom: 40px;">
            <h1 style="font-size: 3rem; margin-bottom: 10px;">ğŸï¸ F1 Circuits</h1>
            <p style="color: #aaa;">ì„œí‚·ì„ í´ë¦­í•˜ì—¬ ìƒì„¸ ê¸°ë¡ì„ í™•ì¸í•˜ì„¸ìš”.</p>
        </section>

        <div class="search-box">
            <input type="text" id="search-input" class="search-input" placeholder="ì„œí‚· ì´ë¦„ì´ë‚˜ êµ­ê°€ ê²€ìƒ‰...">
        </div>

        <div id="circuit-list" class="circuit-grid">
            <p style="color:white; text-align:center;">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
        </div>
    </main>

    <div id="record-modal" class="modal-overlay">
        <div class="modal-content">
            <button class="close-btn" onclick="closeModal()">Ã—</button>
            <h2 id="modal-title" style="color:white; margin-bottom: 20px;">ì„œí‚· ê¸°ë¡</h2>
            <ul id="modal-records" class="record-list">
                </ul>
        </div>
    </div>

    <script src="script.js"></script>
    <script>
        let allCircuits = [];

        async function loadCircuits() {
            try {
                const res = await fetch('http://localhost:3001/api/circuits');
                allCircuits = await res.json();
                renderCircuits(allCircuits);
            } catch (error) {
                console.error(error);
                document.getElementById('circuit-list').innerHTML = '<p style="color:red; text-align:center;">ë¡œë”© ì‹¤íŒ¨</p>';
            }
        }

        function renderCircuits(data) {
            const container = document.getElementById('circuit-list');
            container.innerHTML = data.map(c => `
                <article class="circuit-card" onclick="openRecords(${c.circuit_id}, '${c.name}')">
                    <div class="circuit-img-box">
                        <img src="${c.image_url || 'img/circuit/default.png'}" alt="${c.name}" class="circuit-img">
                    </div>
                    <div class="circuit-info">
                        <h2 class="circuit-name">${c.name}</h2>
                        <p class="circuit-location">ğŸ“ ${c.location}</p>
                        
                        <div class="stats-grid">
                            <div class="stat-item"><span>ê¸¸ì´</span><strong>${c.length_km} km</strong></div>
                            <div class="stat-item"><span>ë© ìˆ˜</span><strong>${c.laps} Laps</strong></div>
                        </div>
                    </div>
                </article>
            `).join('');
        }

        // --- [ëª¨ë‹¬ ê´€ë ¨ í•¨ìˆ˜] ---
        async function openRecords(circuitId, circuitName) {
            const modal = document.getElementById('record-modal');
            const list = document.getElementById('modal-records');
            const title = document.getElementById('modal-title');

            title.innerText = `ğŸ“Š ${circuitName} ê¸°ë¡`;
            list.innerHTML = '<p style="color:white; text-align:center;">ê¸°ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>';
            modal.style.display = 'flex'; // ëª¨ë‹¬ ì—´ê¸°

            try {
                // ê¸°ë¡ API í˜¸ì¶œ
                const res = await fetch(`http://localhost:3001/api/circuits/${circuitId}/records`);
                const records = await res.json();

                if (records.length === 0) {
                    list.innerHTML = '<p style="color:#aaa; text-align:center;">ë“±ë¡ëœ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                } else {
                    list.innerHTML = records.map(r => `
                        <li class="record-item">
                            <div>
                                <span class="record-type">${r.record_type}</span>
                                <span class="record-val">${r.record_value}</span>
                            </div>
                            <div class="record-driver">
                                <div>${r.driver_name}</div>
                                <div style="font-size:0.8rem; color:#666;">${r.team_name} (${r.year})</div>
                            </div>
                        </li>
                    `).join('');
                }
            } catch (err) {
                list.innerHTML = '<p style="color:red; text-align:center;">ê¸°ë¡ ë¡œë”© ì‹¤íŒ¨</p>';
            }
        }

        function closeModal() {
            document.getElementById('record-modal').style.display = 'none';
        }

        // ë°°ê²½ í´ë¦­ ì‹œ ë‹«ê¸°
        document.getElementById('record-modal').addEventListener('click', (e) => {
            if (e.target === document.getElementById('record-modal')) closeModal();
        });

        // ê²€ìƒ‰ ê¸°ëŠ¥
        document.getElementById('search-input').addEventListener('input', (e) => {
            const keyword = e.target.value.toLowerCase();
            const filtered = allCircuits.filter(c => c.name.toLowerCase().includes(keyword) || c.location.toLowerCase().includes(keyword));
            renderCircuits(filtered);
        });

        loadCircuits();
    </script>
</body>
</html>
